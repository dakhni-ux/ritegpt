<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rite GPT | AI</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { background-color: #ffffff; margin: 0; padding: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        .dark body { background-color: #0f172a; }

        /* Centered Logo Watermark */
        .watermark-layer {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 0;
            opacity: 0.05;
        }
        .watermark-layer img { width: 300px; height: auto; }

        /* Force scroll area to take remaining height */
        #messages {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            padding: 1.5rem;
            scroll-behavior: smooth;
        }

        .msg-bubble { max-width: 85%; padding: 1rem; border-radius: 1rem; position: relative; }
        .user-msg { background: #8b5cf6; color: white; align-self: flex-end; border-bottom-right-radius: 0; }
        .ai-msg { background: #f1f5f9; color: #1e293b; align-self: flex-start; border-bottom-left-radius: 0; }
        .dark .ai-msg { background: #1e293b; color: #f1f5f9; }

        #input-area { padding: 1rem; border-top: 1px solid #e2e8f0; background: white; z-index: 10; }
        .dark #input-area { background: #0f172a; border-color: #334155; }
    </style>
</head>
<body class="dark:text-white">

    <div class="watermark-layer">
        <img src="logo.png" alt="" onerror="this.src='./logo.png'; this.onerror=null;">
    </div>

    <div id="auth-screen" class="fixed inset-0 z-50 bg-white dark:bg-slate-900 flex items-center justify-center p-6 text-center">
        <div class="max-w-md w-full">
            <img src="logo.png" class="w-24 h-24 mx-auto mb-4" onerror="this.src='./logo.png';">
            <h1 class="text-4xl font-bold mb-2">Rite GPT</h1>
            <p class="text-slate-500 mb-8">Universal AI Workspace</p>
            <input type="email" id="email-in" placeholder="admin@ritegpt.pro" class="w-full p-4 rounded-xl border dark:bg-slate-800 dark:border-slate-700 mb-4 outline-none">
            <button onclick="login()" class="w-full py-4 bg-purple-600 text-white font-bold rounded-xl shadow-lg">Enter Chat</button>
        </div>
    </div>

    <header class="h-16 flex items-center px-6 border-b dark:border-slate-800 z-10 bg-white dark:bg-slate-900">
        <img src="logo.png" class="w-8 h-8 mr-3" onerror="this.src='./logo.png';">
        <div class="font-bold text-purple-600">Rite GPT</div>
    </header>

    <div id="messages">
        <div id="scroll-anchor"></div>
    </div>

    <div id="input-area">
        <div class="max-w-4xl mx-auto flex gap-2">
            <textarea id="chat-input" rows="1" placeholder="Send a message..." class="flex-1 bg-slate-100 dark:bg-slate-800 p-4 rounded-xl outline-none resize-none"></textarea>
            <button id="send-btn" class="w-14 h-14 bg-purple-600 text-white rounded-xl flex items-center justify-center hover:bg-purple-700">
                <i class="fa-solid fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script>
        const API_KEY = "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";
        const messagesDiv = document.getElementById('messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const scrollAnchor = document.getElementById('scroll-anchor');

        function login() {
            document.getElementById('auth-screen').style.display = 'none';
        }

        async function handleSend() {
            const content = chatInput.value.trim();
            if (!content) return;

            chatInput.value = '';
            chatInput.style.height = 'auto';

            // User Message
            addMessage('user', content);

            // AI Loading state
            const aiMsg = addMessage('ai', 'Thinking...');
            
            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: "deepseek/deepseek-r1:free",
                        messages: [{ role: "user", content: content }]
                    })
                });

                const data = await response.json();
                const reply = data.choices[0].message.content;
                aiMsg.innerHTML = DOMPurify.sanitize(marked.parse(reply));
                
                // Final scroll after content loads
                scrollToBottom();

            } catch (err) {
                aiMsg.innerText = "Error: Could not reach the AI.";
            }
        }

        function addMessage(role, text) {
            const bubble = document.createElement('div');
            bubble.className = `msg-bubble ${role === 'user' ? 'user-msg' : 'ai-msg'}`;
            bubble.innerHTML = text;
            
            // Insert BEFORE the scroll anchor
            messagesDiv.insertBefore(bubble, scrollAnchor);
            
            scrollToBottom();
            return bubble;
        }

        function scrollToBottom() {
            // Smoothly scroll the anchor into view
            scrollAnchor.scrollIntoView({ behavior: 'smooth', block: 'end' });
            
            // Backup scroll for mobile
            setTimeout(() => {
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 100);
        }

        sendBtn.onclick = handleSend;
        chatInput.onkeydown = (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } };

        // Auto-resize text area
        chatInput.oninput = function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        };
    </script>
</body>
</html>
