<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rite GPT | Universal AI</title>
    <link rel="icon" type="image/png" href="logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* The Watermark Logic */
        .watermark-overlay {
            position: fixed;
            inset: 0;
            background-image: url('logo.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 40%;
            opacity: 0.05; /* Light watermark */
            pointer-events: none;
            z-index: 0;
        }
        
        #app, #auth-screen {
            position: relative;
            z-index: 10;
            background: transparent;
        }

        body { background-color: #ffffff; overflow: hidden; }
        .dark body { background-color: #131314; }

        #loading {
            position: fixed;
            inset: 0;
            z-index: 100;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="h-full text-slate-900 dark:text-slate-100">

    <div id="loading">
        <p class="animate-pulse font-bold text-xl">Rite GPT...</p>
    </div>

    <div class="watermark-overlay"></div>

    <div id="auth-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md bg-white/80 dark:bg-zinc-900/80 backdrop-blur-md p-8 rounded-3xl shadow-2xl border border-slate-200 dark:border-zinc-800 text-center">
            <img src="logo.png" class="w-24 h-24 mx-auto mb-4" onerror="this.style.display='none'">
            <h1 class="text-3xl font-bold mb-6">Rite GPT</h1>
            <form id="login-form" class="space-y-4">
                <input type="email" id="email" placeholder="Email (admin@ritegpt.pro)" required
                    class="w-full p-4 rounded-xl border dark:bg-zinc-800 dark:border-zinc-700 outline-none focus:ring-2 focus:ring-purple-500">
                <button type="submit" class="w-full py-4 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-xl transition-all">
                    Login / Enter Chat
                </button>
            </form>
            <button id="guest-btn" class="mt-4 text-slate-500 text-sm hover:underline">Or continue as Guest</button>
        </div>
    </div>

    <div id="app" class="hidden h-full flex flex-col md:flex-row">
        <aside id="sidebar" class="w-72 bg-slate-50 dark:bg-zinc-900 border-r dark:border-zinc-800 flex-col hidden md:flex">
            <div class="p-4 flex items-center gap-3 border-b dark:border-zinc-800">
                <img src="logo.png" class="w-8 h-8">
                <span class="font-bold">Rite GPT</span>
            </div>
            <div id="chat-list" class="flex-1 overflow-y-auto p-2 space-y-1">
                </div>
        </aside>

        <main class="flex-1 flex flex-col h-full relative">
            <header class="p-4 flex justify-between items-center border-b dark:border-zinc-800">
                <button class="md:hidden" onclick="alert('Sidebar mobile toggle active')"><i class="fa-solid fa-bars"></i></button>
                <div class="font-medium text-purple-600" id="model-name">deepseek-r1:free</div>
                <div id="user-tag" class="text-xs opacity-50"></div>
            </header>

            <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-6 pb-32">
                </div>

            <div class="absolute bottom-0 w-full p-4 bg-gradient-to-t from-white dark:from-zinc-950">
                <div class="max-w-3xl mx-auto flex gap-2 items-end bg-slate-100 dark:bg-zinc-800 p-2 rounded-2xl border dark:border-zinc-700">
                    <textarea id="input" rows="1" placeholder="Type your message..." 
                        class="flex-1 bg-transparent p-2 outline-none resize-none max-h-40"></textarea>
                    <button id="send" class="p-3 bg-purple-600 text-white rounded-xl hover:scale-105 transition-transform">
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- LOGIC ---
        const loginForm = document.getElementById('login-form');
        const authScreen = document.getElementById('auth-screen');
        const app = document.getElementById('app');
        const sendBtn = document.getElementById('send');
        const input = document.getElementById('input');
        const messagesDiv = document.getElementById('messages');

        // State
        let user = localStorage.getItem('rite_user');
        const API_KEY = "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";

        function init() {
            document.getElementById('loading').style.display = 'none';
            if (user) {
                showApp();
            }
        }

        function showApp() {
            authScreen.classList.add('hidden');
            app.classList.remove('hidden');
            document.getElementById('user-tag').innerText = user;
        }

        loginForm.onsubmit = (e) => {
            e.preventDefault();
            user = document.getElementById('email').value;
            localStorage.setItem('rite_user', user);
            showApp();
        };

        document.getElementById('guest-btn').onclick = () => {
            user = "Guest User";
            showApp();
        };

        // Simple Send Function
        sendBtn.onclick = async () => {
            const text = input.value.trim();
            if(!text) return;
            
            input.value = '';
            appendMsg('user', text);
            
            const aiMsgDiv = appendMsg('ai', 'Thinking...');

            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: "deepseek/deepseek-r1:free",
                        messages: [{role: "user", content: text}]
                    })
                });
                const data = await res.json();
                aiMsgDiv.innerHTML = marked.parse(data.choices[0].message.content);
            } catch (err) {
                aiMsgDiv.innerText = "Error connecting to OpenRouter.";
            }
        };

        function appendMsg(role, text) {
            const div = document.createElement('div');
            div.className = role === 'user' ? 'flex justify-end' : 'flex justify-start';
            div.innerHTML = `
                <div class="${role === 'user' ? 'bg-purple-600 text-white' : 'bg-slate-200 dark:bg-zinc-800'} p-4 rounded-2xl max-w-[80%] shadow-sm">
                    ${text}
                </div>
            `;
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            return div.querySelector('div');
        }

        window.onload = init;
    </script>
</body>
</html>
